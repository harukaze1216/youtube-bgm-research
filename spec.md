# ğŸµ **youtube-bgm-research**

è©³ç´°ä»•æ§˜æ›¸ v0.3 ï¼ˆ2025-06-23 æ™‚ç‚¹ï¼‰

---

## 1. ç›®çš„ã¨æ¦‚è¦

BGM ç³» YouTube ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã® YouTube API ã‚­ãƒ¼** ã§åé›†ãƒ»åˆ†æã—ã€æ€¥æˆé•·ãƒãƒ£ãƒ³ãƒãƒ«ã®ç™ºæ˜ã¨ç¶™ç¶šãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯é–‹ç™ºè€… GitHub ãƒªãƒã‚¸ãƒˆãƒªã® Issue ã¨ã—ã¦é€ä¿¡ã™ã‚‹ã€‚

---

## 2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

| #     | ã‚¢ã‚¯ã‚¿ãƒ¼   | ã‚·ãƒŠãƒªã‚ª                                                     |
| ----- | ------ | -------------------------------------------------------- |
| UC-01 | æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€å€‹äººã® YouTube API ã‚­ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹                        |
| UC-02 | æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ä¿å­˜æ¸ˆã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è‡ªå‹•æ¤œç´¢ã—ã€ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§ã‚’é–²è¦§ã™ã‚‹                             |
| UC-03 | æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ç‰¹å®šãƒãƒ£ãƒ³ãƒãƒ«ã‚’ **è¿½è·¡ä¸­** ã«åˆ‡ã‚Šæ›¿ãˆã€æˆé•·å±¥æ­´ã‚’ç¢ºèªã™ã‚‹                         |
| UC-04 | æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ä»»æ„ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹                                         |
| UC-05 | æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã‚¢ãƒ—ãƒªã®ä¸å…·åˆã‚’ GitHub Issue ã¨ã—ã¦é€ä¿¡ã™ã‚‹                            |
| UC-06 | ã‚·ã‚¹ãƒ†ãƒ    | GitHub Actions / Cloud Scheduler ãŒå®šæœŸçš„ã«å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½è·¡ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°ã™ã‚‹ |

---

## 3. æ©Ÿèƒ½è¦ä»¶

### 3.1 èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

1. Firebase Authenticationï¼ˆEmail / Passwordï¼‰
2. åˆ©ç”¨é–‹å§‹æ™‚ã« **å¿…é ˆ** ã§ YouTube API ã‚­ãƒ¼ã‚’ç™»éŒ²
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ç·¨é›†ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã€è¨€èªã€ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ—¢å®šãªã©ï¼‰

### 3.2 ãƒãƒ£ãƒ³ãƒãƒ«ç™ºæ˜ & è¿½è·¡

1. **è‡ªå‹•æ¤œç´¢**

   * 138 èªã® BGM ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’èµ°æŸ»
   * é–‹è¨­ â‰¤90 æ—¥ & ç™»éŒ²è€… â‰¥1 000 äººã‚’åˆæœŸãƒ•ã‚£ãƒ«ã‚¿
2. **æ‰‹å‹•è¿½åŠ **

   * ãƒãƒ£ãƒ³ãƒãƒ« URL / ID ã§ç™»éŒ²å¯èƒ½
   * API ã§å­˜åœ¨ãƒã‚§ãƒƒã‚¯å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ
3. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**

   * `unset`ãƒ»`tracking`ãƒ»`non-tracking`ãƒ»`rejected`
   * UI ã§ãƒ‰ãƒ©ãƒƒã‚° & ãƒ‰ãƒ­ãƒƒãƒ—ï¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤‰æ›´
4. **æˆé•·ç‡è¨ˆç®—**

   * `(æœ€æ–°ç™»éŒ²è€…æ•° âˆ’ éå»ç™»éŒ²è€…æ•°) Ã· éå»ç™»éŒ²è€…æ•°` ã‚’æ—¥æ¬¡ã§ç®—å‡º
   * 7 æ—¥ç§»å‹•å¹³å‡ã‚‚ç®—å‡ºã—ã€æ€¥ä¸Šæ˜‡ãƒ•ãƒ©ã‚°ã‚’ä»˜ä¸

### 3.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ãƒ‡ãƒ¼ã‚¿

* **å®Œå…¨åˆ†é›¢**ï¼šFirestore ãƒ«ãƒ¼ãƒ«ã§ `request.auth.uid` ã«ã‚ˆã‚‹ read/write åˆ¶é™
* å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«

  * è‡ªå·±ä¿æœ‰ API ã‚­ãƒ¼
  * åé›†ã—ãŸãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§
  * è¿½è·¡å±¥æ­´
  * å€‹äººè¨­å®šï¼ˆUI è¨€èªã€è¡¨ç¤ºã‚«ãƒ©ãƒ ã€é€šçŸ¥ ON/OFFï¼‰

### 3.4 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ & å¯è¦–åŒ–

* ãƒãƒ£ãƒ³ãƒãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚½ãƒ¼ãƒˆï¼ãƒ•ã‚£ãƒ«ã‚¿ï¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼‰
* æˆé•·ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒˆãƒƒãƒ— 20ï¼‰
* å€‹åˆ¥ãƒãƒ£ãƒ³ãƒãƒ«è©³ç´°ï¼ˆå±¥æ­´ã‚°ãƒ©ãƒ•ï¼šç™»éŒ²è€…æ•°, å‹•ç”»æœ¬æ•°ï¼‰
* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ä»¶æ•°ã‚µãƒãƒª

### 3.5 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆGitHub Issueï¼‰

1. ãƒ•ãƒ­ãƒ³ãƒˆ â†’ Cloud Function ã« POST
2. Function ãŒ `GITHUB_TOKEN` ã§ `/repos/:owner/:repo/issues` ã«ä½œæˆ
3. é€ä¿¡çµæœã‚’ `feedback_reports` ã«è¨˜éŒ²
4. å¤±æ•—æ™‚ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ `error` ã§ä¿æŒã—ã€æ¬¡å›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å†é€ææ¡ˆ

---

## 4. éæ©Ÿèƒ½è¦ä»¶

| åŒºåˆ†         | è¦ä»¶                                                                                     |
| ---------- | -------------------------------------------------------------------------------------- |
| æ€§èƒ½         | 1 API å‘¼ã³å‡ºã—ã‚ãŸã‚Š â‰¤ 400 msï¼ˆp95ï¼‰ã€1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š 10 000 API unit/æ—¥ä»¥å†…                              |
| ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£   | Firestore ã¨ Functions ã® **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹** æ¡ç”¨ã«ã‚ˆã‚Šæ°´å¹³æ–¹å‘æ‹¡å¼µ                                         |
| å¯ç”¨æ€§        | Firebase SLA ã«æº–æ‹ ï¼ˆ99.95 %ï¼‰                                                              |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£     | ãƒ»HTTPS å¼·åˆ¶ãƒ»Firebase Authãƒ»Firestore ãƒ«ãƒ¼ãƒ«ãƒ»GitHub Token ã¯ SecretManager / functions\:config |
| ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ | æ—¥æœ¬èª / è‹±èª UI åˆ‡æ›¿å¯                                                                        |
| ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£   | WCAG 2.1 AA æº–æ‹ ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãƒ»é…è‰²ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼‰                                                       |
| ãƒ­ã‚°         | Cloud Functions / Firestore Audit Log ã‚’ Stackdriver ã«å‡ºåŠ›                                |

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆFirestore è©³ç´°ï¼‰

> `users/{uid}/...` é…ä¸‹ã§**å®Œå…¨åˆ†é›¢**ã™ã‚‹ãƒã‚¹ãƒˆæˆ¦ç•¥ã¨ã€
> ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‹`userId` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æˆ¦ç•¥ã®ä½µç”¨ã€‚
> èª­ã¿å–ã‚Šé »åº¦ãŒé«˜ã„ãƒ‡ãƒ¼ã‚¿ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ç½®ãã€‚

### 5.1 ã‚³ã‚¢ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```text
users/{uid}
â”œâ”€ profile            (doc)  â€¦ name, language, registeredAt, lastLogin
â”œâ”€ settings           (doc)  â€¦ youtubeApiKey, uiPrefs, notificationPrefs
â”œâ”€ channels           (col)  â€¦ per-user channel master
â”‚   â””â”€ {channelId} (doc)
â”‚        â”œâ”€ title
â”‚        â”œâ”€ subscriberCount
â”‚        â”œâ”€ growthRate
â”‚        â”œâ”€ status           // unset | tracking | non-tracking | rejected
â”‚        â”œâ”€ scoreBgmRelev    // 0-100
â”‚        â””â”€ updatedAt
â”‚
â”œâ”€ trackingData       (col)  â€¦ heavyå±¥æ­´ã‚’åˆ†é›¢
â”‚   â””â”€ {autoId} (doc)
â”‚        â”œâ”€ channelId
â”‚        â”œâ”€ subscriberCount
â”‚        â”œâ”€ recordedAt       // timestamp
â”‚        â””â”€ delta            // å‰å›æ¯”
â”‚
â””â”€ feedbackReports    (col)
    â””â”€ {reportId} (doc)
         â”œâ”€ title
         â”œâ”€ body
         â”œâ”€ githubIssueNum   // null until sent
         â”œâ”€ status           // pending | sent | error
         â””â”€ sentAt
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¾‹

```yaml
# channels where status == "tracking" order by growthRate desc
collectionGroup: channels
fields:
  - fieldPath: status
  - fieldPath: growthRate
    order: DESCENDING
```

### 5.2 å…±æœ‰å‚ç…§ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

* `global_channels/{channelId}`

  * ãƒãƒ£ãƒ³ãƒãƒ«ãƒ¡ã‚¿ã ã‘ã‚’ä¸€æ„ã«ä¿æŒã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å‚ç…§
  * é‡è¤‡å‰Šæ¸› & å®šæœŸæ›´æ–°ã®åŠ¹ç‡åŒ–

---

## 6. API ä»•æ§˜ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ Cloud Functionsï¼‰

| åç§°              | ãƒ¡ã‚½ãƒƒãƒ‰        | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ         | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ body      | ãƒ¬ã‚¹ãƒãƒ³ã‚¹              | å‚™è€ƒ              |
| --------------- | ----------- | --------------- | --------------- | ------------------ | --------------- |
| createIssue     | POST        | `/api/feedback` | `{title, body}` | `{issueNumber}`    | GitHub Issue ä½œæˆ |
| refreshChannels | POST (auth) | `/api/refresh`  | none            | `{ processed: n }` | è‡ªå‹•æ¤œç´¢å®Ÿè¡Œ          |
| recalcGrowth    | POST        | `/api/recalc`   | `{channelIds}`  | `{done: true}`     | ç™»éŒ²è€…å±¥æ­´å†è¨ˆç®—        |

---

## 7. Cloud Functions æ§‹æˆ

| ãƒ•ã‚¡ã‚¤ãƒ«                | æ©Ÿèƒ½                                | ãƒˆãƒªã‚¬ãƒ¼             |
| ------------------- | --------------------------------- | ---------------- |
| `createIssue.ts`    | GitHub Issue ä½œæˆ                   | HTTPS            |
| `searchChannels.ts` | 138 ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ âœ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã« channels è¿½åŠ  | Pub/Sub (hourly) |
| `updateTracking.ts` | trackingData è¿½åŠ ãƒ»growthRate æ›´æ–°     | Pub/Sub (daily)  |
| `cleanup.ts`        | å¤ã„å±¥æ­´ 180 æ—¥è¶…ã‚’å‰Šé™¤                    | Pub/Sub (weekly) |

---

## 8. Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆæŠœç²‹ï¼‰

```js
rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {

    function isOwner() { return request.auth != null && request.auth.uid == resource.data.userId; }
    function isSelf(uid) { return request.auth != null && request.auth.uid == uid; }

    match /users/{userId} {
      allow read: if isSelf(userId);
      allow write: if false; // ç›´æ›¸ãã‚’ç¦æ­¢ï¼ˆprofile æ›´æ–°ã¯ subcollection çµŒç”±ï¼‰
      
      match /channels/{channelId} {
        allow read, write: if isSelf(userId);
      }
      match /trackingData/{docId} {
        allow read, write: if isSelf(userId);
      }
      match /settings/{document=**} {
        allow read, write: if isSelf(userId);
      }
      match /feedbackReports/{reportId} {
        allow create: if isSelf(userId);
        allow read, delete: if isSelf(userId);
      }
    }
  }
}
```

---

## 9. UI / UX è©³ç´°

* **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**ï¼šã‚µã‚¤ãƒ‰ãƒãƒ¼ + ãƒ˜ãƒƒãƒ€ãƒ¼-ãƒãƒ¼ã€ãƒ¢ãƒã‚¤ãƒ«æ™‚ã¯ãƒ‰ãƒ­ãƒ¯ãƒ¼
* **ãƒ†ãƒ¼ãƒ–ãƒ«**ï¼šåˆ—è¡¨ç¤ºåˆ‡æ›¿ãƒ»å¤šæ®µã‚½ãƒ¼ãƒˆãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã”ã¨ã«è‰²ãƒãƒƒã‚¸
* **ã‚°ãƒ©ãƒ•**ï¼šChart.js ã§å˜ç´”æŠ˜ã‚Œç·šã€‚è‰²ã¯ Tailwind æ—¢å®š palette ä½¿ç”¨
* **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼šãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ã€Tab ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€alt ãƒ†ã‚­ã‚¹ãƒˆ

---

## 10. ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆä¾‹ï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | æœŸé–“  | ä¸»è¦ã‚¿ã‚¹ã‚¯                |
| ---- | --- | -------------------- |
| Î±    | 7 æœˆ | ãƒ«ãƒ¼ãƒ«å®Ÿè£…ãƒ»GitHub é€£æºãƒ»è‡ªå‹•æ¤œç´¢ |
| Î²    | 8 æœˆ | é€šçŸ¥æ©Ÿèƒ½ãƒ»AI åˆ†æï¼ˆOpenAIï¼‰   |
| GA   | 9 æœˆ | å¤šè¨€èªåŒ–ãƒ»å…¬é–‹å…±æœ‰ï¼æ‹›å¾…æ©Ÿèƒ½       |

---

ä»¥ä¸ŠãŒ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒãƒ£ãƒ³ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ï¼è¨­å®š** ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ãŸè©³ç´°ä»•æ§˜ã§ã™ã€‚
è¿½åŠ ã®é …ç›®ã‚„ç–‘å•ç‚¹ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚ã”æŒ‡ç¤ºãã ã•ã„ã€‚
