import{c as A,d as C,q as $,w as k,g as D,a as x}from"./index-D_xINVJr.js";function P(s){const e=s.trim(),n=[/youtube\.com\/channel\/([UC][a-zA-Z0-9_-]{22})/,/youtube\.com\/c\/([a-zA-Z0-9_-]+)/,/youtube\.com\/user\/([a-zA-Z0-9_-]+)/,/youtube\.com\/@([a-zA-Z0-9_-]+)/,/^(UC[a-zA-Z0-9_-]{22})$/];for(const a of n){const t=e.match(a);if(t)return t[1]}return e}async function T(s){var e,n,a,t,o,i,h;try{const u="AIzaSyDN1sTee52txGVYpQwSWgAD7FUr4NNJinQ",r="https://www.googleapis.com/youtube/v3/channels",c=new URLSearchParams({key:u,id:s,part:"snippet,statistics,contentDetails"}),l=await fetch(`${r}?${c}`),w=await l.json();if(!l.ok)throw new Error(((e=w.error)==null?void 0:e.message)||"API呼び出しエラー");if(!w.items||w.items.length===0)throw new Error("チャンネルが見つかりません");const m=w.items[0],d=m.snippet,p=m.statistics;return{channelId:m.id,channelTitle:d.title,description:d.description,thumbnailUrl:((a=(n=d.thumbnails)==null?void 0:n.high)==null?void 0:a.url)||((o=(t=d.thumbnails)==null?void 0:t.default)==null?void 0:o.url),channelUrl:`https://www.youtube.com/channel/${m.id}`,subscriberCount:parseInt(p.subscriberCount)||0,videoCount:parseInt(p.videoCount)||0,totalViews:parseInt(p.viewCount)||0,publishedAt:d.publishedAt,uploadsPlaylistId:(h=(i=m.contentDetails)==null?void 0:i.relatedPlaylists)==null?void 0:h.uploads}}catch(u){throw console.error("チャンネル情報取得エラー:",u),u}}async function N(s){var e;try{const n="AIzaSyDN1sTee52txGVYpQwSWgAD7FUr4NNJinQ",a="https://www.googleapis.com/youtube/v3/playlistItems";let t=null,o="",i=0;const h=10;console.log(`📹 最初の動画を検索中: ${s}`);do{const u=new URLSearchParams({key:n,playlistId:s,part:"snippet",maxResults:50});o&&u.append("pageToken",o);const r=await fetch(`${a}?${u}`),c=await r.json();if(!r.ok)throw new Error(((e=c.error)==null?void 0:e.message)||"API呼び出しエラー");if(c.items&&c.items.length>0){for(const l of c.items){const w=new Date(l.snippet.publishedAt);(!t||w<new Date(t.publishedAt))&&(t={title:l.snippet.title,publishedAt:l.snippet.publishedAt,videoId:l.snippet.resourceId.videoId})}console.log(`   ページ ${i+1}: ${c.items.length}本の動画をチェック`),console.log(`   現在の最古動画: ${t==null?void 0:t.title} (${t==null?void 0:t.publishedAt})`)}o=c.nextPageToken,i++,await new Promise(l=>setTimeout(l,100))}while(o&&i<h);return console.log(`✅ 最初の動画検索完了: ${(t==null?void 0:t.title)||"なし"}`),t}catch(n){return console.error("最初の動画取得エラー:",n),null}}async function E(s){try{const e=A(C,"bgm_channels"),n=$(e,k("channelId","==",s));return!(await D(n)).empty}catch(e){return console.error("チャンネル存在チェックエラー:",e),!1}}function _(s,e){const n=["BGM","instrumental","background music","ambient","lo-fi","lofi","chill","relaxing","study music","meditation","sleep music","インスト","インストゥルメンタル","ヒーリング","リラックス","作業用","勉強用","睡眠用","瞑想","アンビエント"],a=["lyrics","歌詞","vocal","sing","singing","song","rap","talk","podcast","ボーカル","歌","歌い手","トーク","ラップ"],t=`${s} ${e}`.toLowerCase();for(const o of a)if(t.includes(o.toLowerCase()))return!1;for(const o of n)if(t.includes(o.toLowerCase()))return!0;return!1}async function R(s){var e,n,a,t,o,i;try{const h="AIzaSyDN1sTee52txGVYpQwSWgAD7FUr4NNJinQ",u="https://www.googleapis.com/youtube/v3/playlistItems";let r=null,c="",l=0;const w=5;console.log(`🔥 最も人気の動画を検索中: ${s}`);do{const m=new URLSearchParams({key:h,playlistId:s,part:"snippet",maxResults:50});c&&m.append("pageToken",c);const d=await fetch(`${u}?${m}`),p=await d.json();if(!d.ok)throw new Error(((e=p.error)==null?void 0:e.message)||"API呼び出しエラー");if(p.items&&p.items.length>0){const b=p.items.map(f=>f.snippet.resourceId.videoId),v=await S(b);for(let f=0;f<p.items.length;f++){const g=p.items[f],y=v[g.snippet.resourceId.videoId];if(y){const I=parseInt(y.viewCount)||0;(!r||I>r.viewCount)&&(r={title:g.snippet.title,viewCount:I,likeCount:parseInt(y.likeCount)||0,commentCount:parseInt(y.commentCount)||0,publishedAt:g.snippet.publishedAt,thumbnailUrl:((a=(n=g.snippet.thumbnails)==null?void 0:n.high)==null?void 0:a.url)||((o=(t=g.snippet.thumbnails)==null?void 0:t.default)==null?void 0:o.url),videoId:g.snippet.resourceId.videoId,url:`https://www.youtube.com/watch?v=${g.snippet.resourceId.videoId}`})}}console.log(`   ページ ${l+1}: ${p.items.length}本の動画をチェック`),console.log(`   現在の最人気動画: ${r==null?void 0:r.title} (${(i=r==null?void 0:r.viewCount)==null?void 0:i.toLocaleString()}回再生)`)}c=p.nextPageToken,l++,await new Promise(b=>setTimeout(b,200))}while(c&&l<w);return console.log(`✅ 最人気動画検索完了: ${(r==null?void 0:r.title)||"なし"}`),r}catch(h){return console.error("最人気動画取得エラー:",h),null}}async function S(s){var e;try{const n="AIzaSyDN1sTee52txGVYpQwSWgAD7FUr4NNJinQ",a="https://www.googleapis.com/youtube/v3/videos",t=new URLSearchParams({key:n,id:s.join(","),part:"statistics"}),o=await fetch(`${a}?${t}`),i=await o.json();if(!o.ok)throw new Error(((e=i.error)==null?void 0:e.message)||"API呼び出しエラー");const h={};return i.items&&i.items.forEach(u=>{h[u.id]=u.statistics}),h}catch(n){return console.error("動画統計取得エラー:",n),{}}}function z(s,e){try{const n=e?new Date(e.publishedAt):new Date(s.publishedAt),t=(new Date-n)/(1e3*60*60*24*30);if(t<=0)return 0;const i=s.subscriberCount/t/1e3*100;return Math.round(Math.min(i,999))}catch(n){return console.error("成長率計算エラー:",n),0}}async function G(s){try{const e=A(C,"bgm_channels");return await x(e,{...s,createdAt:new Date,addedManually:!0}),!0}catch(e){throw console.error("Firestore保存エラー:",e),e}}export{G as addChannelToFirestore,z as calculateGrowthRate,E as checkChannelExists,P as extractChannelId,N as fetchChannelFirstVideo,T as fetchChannelInfo,R as fetchChannelMostPopularVideo,_ as isBGMChannel};
